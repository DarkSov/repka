<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <% if (user) {%>
    <title>Welcome, <%= user.username %></title>
    <link rel="stylesheet" href="css/dashboard.css" />
    <% } else { %>
    <title>Log in</title>
    <link rel="stylesheet" href="css/login.css" />
    <% } %>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-0evHe/X+R7YkIZDRvuzKMRqM+OrBnVFBL6DOitfPri4tjfHxaWutUpFmBp4vmVor"
      crossorigin="anonymous"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-pprn3073KE6tl6bjs2QrFaJGz5/SUsLqktiwsUTF55Jfv3qYSDhgCecCxMW52nD2"
      crossorigin="anonymous"
    ></script>
  </head>
  <body>
    <% if (message.length>0) { %>
    <div class="alert alert-danger" role="alert"><%= message %></div>
    <% } %> <% if (user) {%>
    <nav class="navbar navbar-expand-lg bg-light p-0">
      <div class="container-fluid">
        <a class="navbar-brand" href="#">
          <img
            class="m-0 p-0"
            src="img/logo.png"
            alt="Repka"
            width="60"
            height="60"
          />
        </a>
        <div class="d-flex flex-row">
          <p class="mx-3"><%= locals.currentUser.username %></p>
          <a class="text-right" href="/log-out">Log out</a>
        </div>
      </div>
    </nav>

    <div class="container-fluid m-3">
      <div class="row justify-content-between">
        <div class="col-2">
          <select name="sheets" id="sheets-select">
            <option value="">Choose spreadsheet</option>
            <% locals.currentUser.sheets.forEach(function(sheet) { %>
            <option value="<%= sheet.id %>"><%= sheet.name %></option>
            <% }); %>
          </select>
        </div>
        <div class="ml-auto float-right col-1">
          <button
            class="btn btn-secondary"
            type="button"
            data-bs-toggle="offcanvas"
            data-bs-target="#offcanvasExample"
            aria-controls="offcanvasExample"
          >
            Settings
          </button>
        </div>
      </div>
    </div>

    <div
      class="offcanvas offcanvas-end"
      tabindex="-1"
      id="offcanvasExample"
      aria-labelledby="offcanvasExampleLabel"
    >
      <div class="offcanvas-header">
        <h5 class="offcanvas-title" id="offcanvasExampleLabel">Settings</h5>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="offcanvas"
          aria-label="Close"
        ></button>
      </div>
      <div class="offcanvas-body">
        <div class="mb-5">
          <p class="fw-bold">Github settings</p>
          <form action="/save-github-token" class="form" method="POST">
            <label for="githubToken">Github token</label>
            <div class="input-group mb-3">
              <input
                name="githubToken"
                class="form-control"
                type="password"
                placeholder="token"
                required
              />
              <button class="btn btn-outline-secondary" type="submit">
                Save
              </button>
            </div>
          </form>
        </div>

        <div class="mt-4">
          <p class="fw-bold">Spreadsheets settings</p>
          <form
            class="form"
            action="/save-google-spreadsheet"
            id="spreadsheet-form"
            method="POST"
          >
            <label for="spreadsheetId">Google spreadsheet ID</label>
            <input
              class="form-control"
              name="spreadsheetId"
              type="text"
              required
            />
            <label for="spreadsheetName">Name</label>
            <input
              class="form-control"
              name="spreadsheetName"
              type="text"
              required
            />
            <label for="nameRow">Student name row</label>
            <input class="form-control" name="nameRow" type="number" required />
            <div id="task-list"></div>
            <div class="d-flex justify-content-between mt-2">
              <button class="btn btn-primary" type="submit">Save</button>
              <button class="btn btn-secondary" id="add-task">Add task</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <ul class="list-group" id="student-list-group"></ul>
    <div id="student-info"></div>
    <script
      type="text/javascript"
      src="scripts/spreadsheetManagement.js"
    ></script>
    <% } else { %>

    <div class="container login">
      <h1 class="title text-center mb-5">Repka</h1>
      <div class="row justify-content-center">
        <div class="col-md-6">
          <form class="form" action="/log-in" method="POST">
            <h3 class="text-center">Log In</h3>
            <div class="form-group">
              <label for="username" class="">Username:</label><br />
              <input
                type="text"
                name="username"
                id="username"
                class="form-control"
              />
            </div>
            <div class="form-group">
              <label for="password" class="">Password:</label><br />
              <input
                type="password"
                name="password"
                id="password"
                class="form-control"
              />
            </div>
            <div class="form-group mt-3">
              <div class="d-flex justify-content-between">
                <input
                  type="submit"
                  name="submit"
                  class="btn btn-primary px-5"
                  value="Log in"
                />
                <a href="/sign-up" class="">Register here</a>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>

    <%}%>
  </body>
</html>
